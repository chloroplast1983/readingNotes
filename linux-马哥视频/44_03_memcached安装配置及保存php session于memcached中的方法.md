# 44_03\_memcached安装配置及保存php session于memcached中的方法

---

## 笔记

### memcached

键值存储服务器.

**内存**缓存服务器.

基于高性能, 没有使用`xml`格式传输. 使用简单的文本命令.

缓存服务器, 但本身无法决定缓存任何数据.

一半依赖于客户端, 一半依赖于服务端.

不保证数据持久存储.

* 服务端提供存储能力, 检索能力
* 客户端决定如何存, 何时过期
	* 提供键名
	* 缓存时间
	* 值

缓存管理基于`lazy`(惰性)模型. 只要当前空间有, 就不会清空(哪怕过期). 除非没地方用了才清空. 基于**LRU(最近最少使用)**算法清理.

#### 存储大小

* 最小 `48bytes`
* 最大 `1M`

存储数据大小不一致, `Memcached`如何管理数据. **内存碎片**

* buddy system: 伙伴系统
* slab allocator: slab 分配器

##### 伙伴系统

为了实现整个内存当中, 也页面管理方式时, 有足够大的连续内存. 一般每个页面是`4K`.

将临近的空闲的合成一个大的空间.

**避免内存外碎片**

##### slab allocator

实现将小于页面单位, 分成足够小的结构. (如页面`4K`, 分配一个`128`字节大小的结构.

因为操作系统有好多种数据结构, 为每一种数据结构都事先在内存分配好.

只分为, 已用的和空闲的.

一个页面使用完以后在用另外一个页面.

**避免内存内碎片**

#### memcached

比如`512MB`内存, 会事先申请好. 不同大小的内存预先分配好几组. 完成内存高效分配.  早期`Memcached`是2倍增长的, 现在使用增长因子来定义(`growth factor`). 

如增长因子`1.25`:

* 48bytes
* 80bytes

每一堆叫做`slap class`(slap 类别), 每一个类都有块存储数据, 块叫做`slap chunk`.

#### 不通信分布式缓存服务器

分布式算法在客户端应用程序当中. 2台服务器不用互相监控. 所有监控都在客户端实现.

一致性`hash`.



## 整理知识点