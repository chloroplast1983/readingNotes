# 6.利用Linux文件系统权限控制文件访问

## Linux文件系统权限

* Linux文件系统权限
* 查看文件/目录权限和所有权

### Linux文件系统权限

三个应用权限的用户类别:

* 用户
* 用户组
* 其他

#### 权限对文件和目录的影响

* `r`读取
	* 文件: 读取文件内容.
	* 目录: 列出目录的内容(文件名).
* `w`写入
	* 文件: 更改文件的内容.
	* 目录: 创建或删除目录中的任一文件.
* `x`执行
	* 文件: 作为命令执行文件.
	* 目录: 访问目录的内容(进入目录)

* 用户对**只读目录**具有**read**和**exec**权限. 列出目录并访问其内容.
* 用户对目录**read**权限, 列出其中文件名称, 其他信息(权限, 时间戳)不可用, 也不能进入目录.
* 用户对目录**exec**权限, 不能累出该目录中文件的名称, 但如果他们已知道对其具有读权限的文件的名称, 那么他们可以通过**明确地指定文件名**来访问该文件的内容.
* 用户对目录**write**权限, 可以删除此文件, **不论文件本市的所有权或权限如何**. **(删除文件权限是看目录, 而不是看文件本身)**

### 查看文件/目录权限和所有权

* `ls -l dir`展开文件列表, 包括文件的权限和所有权. 显示驻留在该目录中所有文件的扩展列表.
* `ls -d dir`显示目录本身的扩展列表.

## 从命令行管理文件系统权限

* 更改文件/目录的权限
* 更改文件/目录的用户或组所有权

### 更改文件/目录的权限

`chmod`命令更改权限.

#### 符号法关键字

`chmod WhoWhatWhich file|directory`

* Who: `u`(用户), `g`(组), `o`(其他), `a`(全部)
* What: `+,-,=`(代表添加, 删除, 精确设置）
* Which: `r,w,x`(代表读取, 写入, 可执行)

#### 数值法

`chmod ### file|directory`

* 每个数字代表一个访问级别: 用户, 组, 其他.
* `#`下列数字之和:
	* `r=4`
	* `w=2`
	* `x=1`

权限由三位(设置高级权限时为四位)八进制数来表示.

#### X 和 x

`chmod -R X`, 中`-R`表示递归地设置. `X`表示**仅对目录而不是普通文件设置执行权限**.

### 更改文件/目录的用户或组所有权

新建的文件由创建该文件的用户所有.

新文件的**组**所有权为创建该文件的**主要用户组**.

`chown owner:group`更改文件所有权.

* `root`用户可以更改文件的所有权.
* 非`root`用户仅可将所有权授予给他们所属的组.

`-R`可以递归作用于整个目录树.

`chgrp`命令更改组所有权.

## 管理默认权限和文件访问

* 特殊权限
* 默认文件权限

### 特殊权限

* `u+s(suid)`, 作用在权限的执行位上: 对可执行文件的`setuid`或(setgid)权限表示将以维诺健的用户(或组)身份运行命令, 而不是以运行命令的用户身份.
	* 文件: 以拥有文件的用户身份, 而不是以运行文件的用户身份执行文件. 如`passwd`.
	* 目录: 无影响.
* `g+s(sgid)`, 作用在权限的执行位上
	* 文件: 以拥有文件的组身份执行文件.
	* 目录: 对目录中最新创建的文件将其组所有者设置为目录的组所有者相匹配.
* `o+t(sticky)`:
	* 文件： 无影响.
	* 目录: 对**目录具有写入权限**的用户尽可以删除其所拥有的文件, 而无法删除或强制保存到其他用户所拥有的文件.(控制对目录中文件的删除权限)

```
[ansible@bunker ~]$ ll -s /usr/bin/passwd
28 -rwsr-xr-x. 1 root root 27832 Jun 10  2014 /usr/bin/passwd
```

#### 使用场景

**目录`sgid`**

一般运用在小组项目中. 比如一个设置一个专用目录给一个小组进行使用, 里面的文件可以对组成员进行开发使用. 而且所有新创建的文件都属于一个组.

**目录`sticky`**

如果对目录了读写执行权限, 那么任何人就可以删除目录中的文件了, 哪怕文件本身没有写权限和执行权限. 这个时候sticky粘滞位就体现出来了. 它的作用就是所有人只能创建自己的文件, 以及删除自己的文件. 增强文件的安全性.

#### 设置特殊权限

* 符号： `setuid=u+s; setgid=g+s; sticky=o+t`
* 数值(第四位): `setuid=4; setgid=2; sticky=1`

### 默认文件权限

系统中的每个进程都就具有`umask`, 它是一位八进制位掩码, **用于清除由该进程创建的新文件或目录的权限**. 如果在`umask`中设置了一个位, 则新文件中的对应的权限将被清除.

`Bash shell`用户的系统默认`umask`在`/etc/profile`和`/etc/bashrc`文件中定义. 用户可以在他们的`.bash_profile`和`.bashrc`文件中覆盖系统默认值.

* 创建文件, 默认是从最大权限`666`减去`umask`值. 默认创建的文件没有可执行权限.
* 创建文件夹, 默认是从最大权限`777`减去`umask`值. 

