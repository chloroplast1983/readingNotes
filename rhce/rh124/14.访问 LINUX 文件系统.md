# 14.访问 LINUX 文件系统

## 识别文件系统和设备

* 存储管理概念
* 检查文件系统

### 存储管理概念

文件系统是包含保存数据的文件和目录的有序结构, 驻留在物理磁盘或分区等存储设备上.

文件系统层次结构将所有文件系统汇集为一个具有单个根(/目录)的目录树. **优点**, 现有层次结构可以随时扩展. 只需添加包含支持的文件系统的新磁盘或分区. 即可在文件系统树的任何位置增加磁盘空间. 将新文件系统添加到现有目录树的过程称为**挂载**. 其中挂载了新文件系统的目录称为**挂载点**.

硬盘和存储设备通常划分为更小的块, 称为**分区**. **分区**是划分硬盘的一种方法. 不同的部分可以通过不同的文件系统进行格式化或用于不同的目的.

将数据放在两个独立分区上的两个独立文件系统有助于规划数据存储.

**存储设备由一个特殊文件类型表示**, 称为**块设备**. **块设备存储叜/dev目录中**.

#### 逻辑乱

`LVM`, 一个或的扩个块设备可以汇集为一个存储池, 称为卷组. 磁盘空间以一个或多个逻辑卷提供.

**卷组**, 在`/dev`目录中有一个名称与该卷组相同的目录. 在该目录下, 已创建名称与逻辑卷相同的符号链接. 如代表`myvg`卷组中`mylv`逻辑卷设备文件是`/dev/myvg/mylv`.

`LVM`依赖于设备映射程序(DM)内核驱动程序. 以上**符号链接**`/dev/myvg/mylv`指向`/dev/dm-number`块设备节点. `number`的分配是连续的, 从零(0)开始. 每个逻辑卷在`/dev/mapper`目录中有另外一个符号链接, 名称为`/dev/mapper/myvg-mylv`. **使用任一可靠且一直的符号链接名称来访问逻辑卷, 因为`/dev/dm-number`名称在每次启动会有所不同**.

### 检查文件系统

`df`报告所有已挂载的普通文件系统的总磁盘空间, 已用磁盘空间和可用磁盘空间.

`tmpfs`和`devtmpfs`设备是系统**内存中的文件系统**. 重启后会消失.

参数:

* `-h`: 单位是`Kib(2^10),Mib(2^20),GiB(2^30)`
* `-H`: 以`SI`为单位, 即`KB(10^3),MB(10^6),GB(10^9)`

`du`查看有关某一特定目录树使用的空间的详细信息. `du`命令以递归方式显示当前目录树中所有文件的大小.

## 挂载和卸载文件系统

* 手动挂载文件系统
* 卸载文件系统
* 访问可移动存储设备

### 手动挂载文件系统

`mount`命令允许`root`用户手动挂载文件系统.

* 第一个参数: 要挂载的文件系统.
	* 设备文件`/dev`中.
	* 文件系统的通用唯一识别符`UUID`.
* 第二个参数: 目标目录, 挂载点.

`blkid`累出骑上具有文件系统的现有分区和文件系统的`UUID`, 以及用户格式化该分区的文件系统.

**如果用作挂载点的目录不为空, 则只要有文件系统挂载到该目录, 其中已存在的文件将不可访问**. 新的文件会写入到此处的文件系统中.

### 卸载文件系统

`umount`使用挂载点为参数卸载文件系统.

如果挂载点正在由某一进程访问, 将无法卸载. 要成功执行`umount`命令, 该进程需要停止访问挂载点.

`lsof`命令列出**所给目录**中所有打开的文件以及访问它们的进程. 发现进程可以等待进程解说, 或者发送信号终止进程.

**lsof**在卸载文件系统的时候很有用. 一般情况要检查下当前工作目录是否在该挂载点内.

### 访问可移动存储设备

`usb`在**图形桌面环境**自动挂载. 挂载点是`/run/media/<user>/<label>`.

* user 是登录用户
* label 是文件系统创建时所的名称

## 制作文件间的链接

* 管理文件间的链接

### 管理文件间的链接

#### 创建硬链接

硬链接是**新的目录条目**, 其引用文件系统中的现有文件. **文件系统中的每一文件默认具有一个硬链接**.

为了**节省空间, 可以不复制文件, 而创建医用同一文件的新硬链接**.

新硬链接如果在与现有硬链接相同的目录中创建, **则需要具有不同的文件名, 否则需要驻留于不同的目录中**(因为是新的目录条目). **指向同一文件内容的硬链接需要在相同的文件系统中**.

`ln`:

* 第一个参数: 现有文件.
* 第二个参数: 一个或多个额外的硬链接.

硬链接可以处于任何位置上, 只要它们与现有文件在同一个文件系统中. 在新硬链接创建后, 无法区别哪一现有硬链接是原始链接. 即使原始文件被删除, 只要存在至少一个硬链接, 该文件的内容就依然可用.

**引用统一文件的所有硬链接具有相同的权限, 链接数, 用户/组所有权, 时间戳, 以及文件内容**.

#### 创建软连接

`ln -s`命令穿件软连接, 也称为符号链接. 软连接是特殊的文件类型, 它指向现有的文件或目录. **可以指向其他文件系统中的文件或目录**.

如果链接目标文件被删除, 指向缺失的文件的软链接称为**悬挂的软链接**.

**软链接可以指向目录**.

## 查找系统中的文件

* 文件查找工具
* 使用 locate 根据名称查找文件
* 使用 find 搜索文件

### 文件查找工具

`locate`命令搜索预生成数据库中的文件名或文件路径.

`find`命令通过爬取整个文件系统来实施搜索文件系统.

### 使用 locate 根据名称查找文件

`locate`命令根据`locate`数据库中的文件名或路径返回搜索结果. 该数据库存储文件名和路径信息.

普通用户身份搜索条目时, 调用`locate`搜索的用户必须对包含匹配元素的目录树拥有**读权限**, 才会返回结果.

* `-i`不区分大小写搜索.
* `-n`限制返回的搜索结果.

`locate`数据库会每日自动更新. `root`用户可以通过`updatedb`命令更新数据库.

### 使用 find 搜索文件

`find`命令在本地文件系统中执行**实时搜索**.

调用`find`命令的用户必须具有要查看其内容的目录的**读取和执行权限**.

`find`参数:

* 第一个参数: 要搜索的目录, 如果省略则从当前目录中开始搜索.
* 其他参数:
	* `-name` 根据文件名查询匹配. 可以使用通配符. `-name '*.txt'`
	* `-iname` 不区分大小写的搜索.
	* `-user -group`, `-uid -gid` 根据所有权搜索.
	* `-pam` 查看具有特定权限集的文件. 8禁进制.
		* `0` 类似通配符, 表示至少无任何内容的权限. 如`004`, 至少其他人具有读权限.
	* `-size` 指定大小, 如`1M`会显示小于1MB的文件, 会将所有文件向上取整.
		* `k`
		* `M`
		* `G`
	* `-min xxx` `xxx`以分钟表示的时间. 索索正在过去所给时间更改的所有文件.
	* `-type` 限制为指定的文件类型
		* `f` 表示普通文件
		* `d` 表示目录
		* `l` 表示软链接
		* `b` 表示块设备
	* `-links`查找具有特定硬链接数的文件.
		* `+` 大于该硬链接数
		* `-` 小于该硬链接数