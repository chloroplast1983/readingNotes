# 9. 配置 MARIADB 数据库

## 安装 MariaDB

* 关系数据库
* MariaDB 和联网

### 关系数据库

关系数据库是一种机制, 能够以有组织的方式持久存储数据. 数据库存储数据项时将其组织为一组表, 每个表代表一个实体. 在给定的表中, 每个行对应一个记录, 而每个列对应该记录的某个属性.

### MariaDB 和联网

**skip-networking**, 如果设置为 1, 服务器将侦听本地客户端. 将通过套接字与服务器进行所有交互, 默认情况下, 套接字位于`/var/lib/mysql/mysql.sock`. 可以使用`/etc/my.cnf`中的`socket`值来更改此位置.

## 管理数据库用户和访问权限

* 使用 MariaDB 创建用户账户

### 使用 MariaDB 创建用户账户

创建用户时, 如果未提供主机名, 则假定主机名为`%`. 这意味着该用户可以从任何源主机进行访问.

在授予或撤销某项特权后, 将从`mysql`数据库中的特权表中重新加载所有特权.

```mysql
FLUSH PRIVILEGES
```

通过命令`SHOW GRANTS FOR username`可以查看该用户的特权列表.

## 创建和恢复 MariaDB 备份

* 创建备份
* 执行物理备份
* 恢复备份

### 创建备份

备份方法:

* 逻辑
* 物理(原始)

**逻辑备份**在纯文本文件中导出信息和记录.

**物理备份**包含存储怒诶荣的文件和目录的副本.

逻辑备份特征:

* 数据库结构是通过查询数据库来检索的
* 逻辑备份的可移植性高
* 备份过程慢, 因为服务器必须访问数据库信息并将其转换为逻辑格式
* 在服务器联机时执行
* 备份不包含日志和配置文件

物理佩芬特征:

* 包含数据库目录和文件夹的原始副本
* 输出更精简
* 备份可以包含日志和配置文件
* 只能一直到具有类似硬件和软件的其他计算机
* 比逻辑备份快
* 应在服务器脱机或者数据库中有表均锁定时执行, 防止在备份期间发生更改

### 执行物理备份 

1. 连接都数据库, 将表刷新到磁盘, 并将其锁定

```
FLUSH TABLES WITH READ LOCK;
```

2. 另外一个中断, 创建 LVM 快照

```
lvcreate -L20G -s -n xxxx /dev/vg0/xxxx
```

3. 在原始会话中借宿表

```
UNLOCK TABLES
```

4. 挂载快照并备份

