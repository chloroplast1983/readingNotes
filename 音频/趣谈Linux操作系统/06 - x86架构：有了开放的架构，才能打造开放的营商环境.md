# 06 | x86架构：有了开放的架构，才能打造开放的营商环境

## 笔记

### x86

`x86`架构就是这样一个开放平台, 适配各种千差万别的硬件.

### 计算机的工作模式是什么样的?

![](./img/06_01.jpeg)

**CPU(Central Processing Unit, 中央处理器)**, 计算机的大脑. 将来执行项目都要靠它.

CPU和其他设备连接, 靠一种叫做**总线(Bus)**的东西, 就是主板上密密麻麻的集成电路, 这些东西组成了CPU和其他设备的高速通道.

**内存(Memory)**. 单靠CPU是没办法完成计算任务的, 很多复杂的计算任务都需要将终结结果保存下来, 然后基于中间结果进行进一步的计算. **CPU本身没办法保存这么多中间结果, 这就要依赖内存了**.

### CPU和内存是如何配合工作的

CPU包括三个部分

* 运算单元
* 数据单元
* 控制单元

#### 1. 运算单元

运算单元**只管算**, 加法, 位移等等. **但是它不知道应该算哪些数据, 运算结果应该放在哪里**.

#### 2. 数据单元

运算单元计算的数据如果每次都要经过总线, 都内存里面现拿, 就太慢了, 所以就有了**数据单元**.

数据单元包括

* CPU内部的缓存
* 寄存器组

**空间很小, 但是速度飞快, 可以暂时存放数据和运算结果**

#### 3. 控制单元

有了放数据的地方, 也有了算的地方, 还需要有个指挥到底做什么运算的地方, 这就是**控制单元**.

控制单元是一个统一的指挥中心, 可以获得下一条指令, 然后执行这条指令. 这个指令会指导运算单元取出数据单元的某几个数据, 计算出个结果, 然后放在数据单元的某个地方.

![](./img/06_02.jpeg)

每个项目都有一个项目执行计划书, 里面是一行行项目执行的指令, 这些都是放在档案库里面的.

每个进程都有一个程序放在硬盘上, 是二进制的, 再里面就是一行行的指令, 会操作一些数据.

进程一旦运行, 如图中的 A 和 B, 会有独立的内存空间, 互相隔离, 程序会分别加载到进程 A 和进程 B 的内存空间里面, 形成各自的代码段.

程序运行的过程中要操作的数据和产生的计算结果, 都会放在数据段里面. 

**CPU怎么执行这些程序, 操作这些数据, 产生一些结果, 并写入回内存呢?**

CPU的控制单元里面, 有一个**指令指针寄存器**, 它里面存放的是下一条指令在内存中的地址. 控制单元会不停地将代码段的指令拿出来, 先放入指令寄存器.

当前的指令分两部分:

* 一部分是做什么操作, 例如是加法还是位移.
* 一部分是操作哪些数据.

**要执行这条指令, 要把第一部分交给运算单元, 第二部分交给数据单元**

数据单元根据数据的地址, 从数据段里读到数据寄存器里, 就可以参与运算了.  运算单元做完运算, 产生的结果会暂存在数据单元的数据寄存器里. 最终, 会有指令将数据写会内存中的数据段.

#### 进程切换

CPU里有两个进村器, 专门保存**当前处理**进程的代码段的起始地址, 以及数据段的起始地址. 这里面写的都是进程 A, 那当前执行的就是进程 A 的指令, 等切换进程 B, 就会执行 B 的指令了, 这个过程叫做**进程切换(Process Switch)**,

#### 地址总线 和 数据总线

CPU 和 内存来来回回传数据, 靠的都是总线. 起始总线上主要有两类数据, 一个是地址数据，我想**拿内存中哪个位置**的数据, 这类总线叫做**地址总线(Address Bus)**. 另一类是真正的数据, 这类总线叫做**数据总线(Data Bus)**.



## 扩展