# 协议专栏特别福利 | 答疑解惑第二期

## 笔记

### 1. net-tools 和 iproute2 的区别

`net-tools`通过`/procfs(/proc)`和`ioctl`系统调用去访问和改变内核网络配置.

`iproute2`通过`netlink`套接字接口与内核通讯.

### 2. 组播和广播的意义和原理是什么?

广播和组播分为两个层面.

`MAC`层和`IP`层均有广播和组播对应的地址

广播, `MAC`层的广播为`ff:ff:ff:ff:ff:ff`, `IP`层指向子网的广播地址为主机号为`1`且有特定子网号的地址.

组播, `MAC`层中地址最高字节的最低位设置为`1`时, 表示该地址是一个组播地址, 用十六进制可表示为`01:00:00:00:00:00`. `IP`层, 组播地址为`D`类`IP`地址.

多播进程将目的`IP`地址指明为多播地址, 设备驱动程序将它转换为相应的`MAC`地址. 然后把数据发出去. 这些接收进程必须通知它们的`IP`层, 它们想接收的发给指定多播地址的数据报, 并且设备驱动程序必须能够接收这些多播帧. 这个过程就是**加入一个多播组**.

多播跨越路由器的时候, 需要通过`IGMP`协议告诉多播路由器, 多播数据报应该如何转发.

### 3. MTU 1500 的具体含义是什么?

`MTU(Maximum Transmission Unit, 最大传输单元)`是**二层**的一个定义.

* 在`IP`层, 一个`IP`数据报在以太网中传输, 如果它的长度大于该`MTU`值, 就要进行分片传输.
* 在`TCP`层, 有个`MSS(Maximum Segment Size, 最大分段大小)`, 等于`MTU`减去`IP`头, 再减去`TCP`头. **即在不分片的情况下, TCP里面放的最大内容**.
* 在`HTTP`层看来, 它的`body`没有限制, 而且在应用层看来, 下层的`TCP`是一个流, 可以一直发送, **但其实是会被分成一个个段的**.

### 4. DHCP防止IP冲突

* 客户端检测, 客户端在接收分配的`IP`之前, 先发送一个`ARP`, 看是否有应答, 有就说明冲突了, 于是发送一个`DHCPDECLINE`, 放弃这个`IP`地址.
* 服务器检测, `DHCP`服务器会发送`ping`, 来看某个`IP`是否已经被使用. 如果被使用了, 就不再将这个`IP`分配各其他的客户端了.

### 5. DHCP 的 Offer 和 ACK 应该是单播还是广播呢

`DHCP Offer`包中`Boradcast`位:

* `1`, 使用广播发送, 如果客户端的协议栈, 没配置好`IP`就不能接收单播的包, 就将`Boradcast`设置为`1`, 以广播形式进行交互.
* `0`, 使用单播发送. 没配置好`IP`, 扔能够接收单播的包, 就将`Boradcast`设置为`0`, 以单播的形式交互.

### 6. 在 MAC 地址已经学习的情况下，ARP 会广播到没有 IP 的物理段吗?

* `ARP`目标地址是广播的, 无论是否进行地址学习都会广播.
* 对于某个`MAC`地址的访问, 在没有地址学习的时候, 是转发到所有的端口, 学习之后, 只会转发到有这个`MAC`的端口.

## 扩展

### 各种设备将其对应网络分层概念

* 物理层: 中继器
* 数据链路层: 网桥/2层交换机
* 网络层: 路由器/3层交换机
* 4-7层: 网关(协议转换器, 由于历史的原因, 通常指的网关就是路由器的IP)